# 母函数（Generating function）详解

来自[Tanky Woo](http://www.wutianqi.com/blog/596.html)

在数学中，某个序列的母函数(Generating function，又称生成函数)是一种形式幂级数，其每一项的系数可以提供关于这个序列的信息。使用母函数解决问题的方法称为母函数方法。

母函数可分为很多种，包括普通母函数、指数母函数、L 级数、贝尔级数和狄利克雷级数。对每个序列都可以写出以上每个类型的一个母函数。构造母函数的目的一般是为了解决某个特定的问题，因此选用何种母函数视乎序列本身的特性和问题的类型。

这里先给出两句话，不懂的可以等看完这篇文章再回过头来看：

1. “把组合问题的加法法则和幂级数的乘幂对应起来”
2. “母函数的思想很简单 --- 就是把离散数列和幂级数一 一对应起来，把离散数列间的相互结合关系对应成为幂级数间的运算关系，最后由幂级数形式来确定离散数列的构造. "

## 我们首先来看下这个多项式乘法：

![母函数图(1)](https://images.tankywoo.com/oldblog/2010/08/muhanshu5.png)

**由此可以看出**:

1. x 的系数是 a1,a2,…an 的单个组合的全体。
2. x^2 的系数是 a1,a2,…a2 的两个组合的全体。
3. x^n 的系数是 a1,a2,….an 的 n 个组合的全体（只有 1 个）。

**进一步得到**：

![母函数图(2)](https://images.tankywoo.com/oldblog/2010/08/muhanshu6.png)

**母函数的定义**

对于序列 a0，a1，a2，…构造一函数：

![母函数图(3)](https://images.tankywoo.com/oldblog/2010/08/muhanshu7.png)

称函数 G(x)是序列 a0，a1，a2，…的母函数。

## 这里先给出 2 个例子，等会再结合题目分析：

- 第一种：

**有 1 克、2 克、3 克、4 克的砝码各一枚，能称出哪几种重量？每种重量各有几种可能方案？**

考虑用母函数来解决这个问题：

我们假设 x 表示砝码，x 的指数表示砝码的重量，这样：

- 1 个 1 克的砝码可以用函数 1+1\*x^1 表示，
- 1 个 2 克的砝码可以用函数 1+1\*x^2 表示，
- 1 个 3 克的砝码可以用函数 1+1\*x^3 表示，
- 1 个 4 克的砝码可以用函数 1+1\*x^4 表示，

我们拿 1+x^2 来说，前面已经说过，x 表示砝码，x 的指数表示砝码的重量！初始状态时，这里就是一个质量为 2 的砝码。

那么前面的 1 表示什么？按照上面的理解，1 其实应该写为：`1*x^0`,即 1 代表重量为 2 的砝码数量为 0 个。

所以这里 `1+1x^2 = 1x^0 + 1x^2`，即表示 2 克的砝码有两种状态，不取或取，不取则为 `1x^0`，取则为 `1*x^2`

不知道大家理解没，我们这里结合前面那句话：

**“把组合问题的加法法则和幂级数的乘幂对应起来“**

接着讨论上面的 `1+x^2`，这里 x 前面的系数有什么意义？

这里的系数表示状态数(方案数)

`1+x^2`，也就是 `1x^0 + 1x^2`，也就是上面说的不取 2 克砝码，此时有 1 种状态；或者取 2 克砝码，此时也有 1 种状态。(分析！)

所以，前面说的那句话的意义大家可以理解了吧？

几种砝码的组合可以称重的情况，可以用以上几个函数的乘积表示：

```
(1+x)(1+x^2)(1+x^3)(1+x^4)

=(1+x+x^2+x^4)(1+x^3+^4+x^7)

=1 + x + x^2 + 2x^3 + 2x^4 + 2x^5 + 2x^6 + 2x^7 + x^8 + x^9 + x^10
```

从上面的函数知道：可称出从 1 克到 10 克，系数便是方案数。（！！！经典！！！）

例如右端有 2^x^5 项，即称出 5 克的方案有 2 种：5=3+2=4+1；同样，6=1+2+3=4+2；10=1+2+3+4。

故称出 6 克的方案数有 2 种，称出 10 克的方案数有 1 种 。

接着上面，接下来是第二种情况：

- 第二种：

求用 1 分、2 分、3 分的邮票贴出不同数值的方案数：

大家把这种情况和第一种比较有何区别？第一种每种是一个，而这里每种是无限的。

![母函数图(4)](https://images.tankywoo.com/oldblog/2010/08/muhanshu8.png)

以展开后的 x^4 为例，其系数为 4，即 4 拆分成 1、2、3 之和的拆分方案数为 4；

即 ：`4=1+1+1+1=1+1+2=1+3=2+2`

这里再引出两个概念"整数拆分"和"拆分数"：

所谓整数拆分即把整数分解成若干整数的和（相当于把 n 个无区别的球放到 n 个无标志的盒子，盒子允许空，也允许放多于一个球）。

整数拆分成若干整数的和，办法不一，不同拆分法的总数叫做拆分数。

现在以上面的第二种情况每种种类个数无限为例，给出模板：

```cpp
#include
using namespace std;
// Author: Tanky Woo
// www.wutianqi.com

const int _max = 10001;

// c1 是保存各项质量砝码可以组合的数目
// c2 是中间量，保存没一次的情况
int c1[_max], c2[_max];

int main(){
    int nNum;
    int i, j, k;

    while(cin >> nNum){
        for(i=0; i<=nNum; ++i){   // ---- ①
            c1[i] = 1;
            c2[i] = 0;
        }
        for(i=2; i<=nNum; ++i){   // ----- ②
            for(j=0; j<=nNum; ++j){  // ----- ③
                for(k=0; k+j<=nNum; k+=i){  // ---- ④
                    c2[j+k] += c1[j];
                }
            }
            for(j=0; j<=nNum; ++j){     // ---- ⑤
                c1[j] = c2[j];
                c2[j] = 0;
            }
        }
        cout << c1[nNum] << endl;
    }
    return 0;
}
```

我们来解释下上面标志的各个地方：(**！！！重点！！！**)

- ① 首先对 c1 初始化，由第一个表达式(1+x+x^2+..x^n)初始化，把质量从 0 到 n 的所有砝码都初始化为 1.
- ② i 从 2 到 n 遍历，这里 i 就是指第 i 个表达式，上面给出的第二种母函数关系式里，每一个括号括起来的就是一个表达式。 > > > > ③、j 从 0 到 n 遍历，这里 j 就是(前面 i 個表达式累乘的表达式)里第 j 个变量。如(1+x)(1+x^2)(1+x^3)，j 先指示的是 1 和 x 的系数，i=2 执行完之后变为 （1+x+x^2+x^3）(1+x^3)，这时候 j 应该指示的是合并后的第一个括号的四个变量的系数。
- ④ k 表示的是第 j 个指数，所以 k 每次增 i（因为第 i 个表达式的增量是 i）。
- ⑤ 把 c2 的值赋给 c1,而把 c2 初始化为 0，因为 c2 每次是从一个表达式中开始的。

**咱们赶快趁热打铁，来几道题目**：

（相应题目解析均在相应的代码里分析）

题目：http://acm.hdu.edu.cn/showproblem.php?pid=1028
代码：http://www.wutianqi.com/?p=587

这题大家看看简单不？把上面的模板理解了，这题就是小 Case!

看看这题：

题目：http://acm.hdu.edu.cn/showproblem.php?pid=1398
代码：http://www.wutianqi.com/?p=590

要说和前一题的区别，就只需要改 2 个地方。 在 i 遍历表达式时（可以参考我的资料—《母函数详解》），把 i<=nNum 改成了 ii<=nNum,其次在 k 遍历指数时把 k+=i 变成了 k+=ii; Ok,说来说去还是套模板~~~

题目：http://acm.hdu.edu.cn/showproblem.php?pid=1085
代码：http://www.wutianqi.com/?p=592

这题终于变化了一点，但是万变不离其中。

大家好好分析下，结合代码就会懂了。

题目：http://acm.hdu.edu.cn/showproblem.php?pid=1171
代码：http://www.wutianqi.com/?p=594

还有一些题目，大家有时间自己做做：

HDOJ：1709，1028、1709、1085、1171、1398、2069、2152

---

附：

1.在维基百科里讲到了普通母函數、指數母函數、L 級數、貝爾級數和狄利克雷級數：

http://zh.wikipedia.org/zh-tw/%E6%AF%8D%E5%87%BD%E6%95%B0

2．Matrix67 大牛那有篇文章：什么是生成函数：

http://www.matrix67.com/blog/archives/120

3.大家可以看看杭电的 ACM 课件的母函数那篇，我这里的图片以及一些内容都引至那。
