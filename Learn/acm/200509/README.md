# 组合博弈入门

## 简单取子游戏 （组合游戏一种）

- `组合游戏`

  1. 有两个玩家

  2. 游戏的操作状态是一个有限的集合（比如：限定大小的棋盘）

  3. 游戏双方轮流操作

  4. 双方的每次操作必须符合游戏规定

  5. 当一方不能将游戏继续进行的时候，游戏结束，同时，对方为获胜方

  6. 无论如何操作，游戏总能在有限次操作后结束

### 概念

- **必败点(P 点)**: 前一个选手(Previous player)将取胜的位置称为必败点。

- **必胜点(N 点)**: 下一个选手(Next player)将取胜的位置称为必胜点。

### 属性

- (1) 所有终结点是必败点（P 点）

- (2) 从任何必胜点（N 点）操作，至少有一种方法可以进入必败点（P 点）

- (3) 无论如何操作， 从必败点（P 点）都只能进入必胜点（N 点）

## 算法实现（自然语言）

1. 将所有终结位置标记为必败点（P 点）

2. 将所有一步操作能进入必败点（P 点）的位置标记为必胜点（N 点）

3. 如果从某个点开始的所有一步操作都只能进入必胜点（N 点） ，则将该点标记为必败点（P 点）

4. 如果在步骤 3 未能找到新的必败（P 点），则算法终止；否则，返回到步骤 2。

### 示例

- 取子游戏: S = {1, 3, 4}

| 剩余 | 0   | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10  | 11  | 12  | 13  | 14  | …   |
| ---- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 状态 | P   | N   | P   | N   | N   | N   | N   | P   | N   | P   | N   | N   | N   | N   | P   | …   |

## Nim 游戏

### 简介

- 有两个玩家
- 有三堆扑克牌（比如：分别是 5, 7, 9 张）
- 游戏双方轮流操作
- 玩家的每次操作是选择其中某一堆牌，然后从中取走任意张
- 最后一次取牌的一方为获胜方

### nim-sum

![nim-sum定义](https://i.loli.net/2020/05/09/sWLIPJqt7D2Y3ku.png)

### 定理

对于 nim 游戏的某个位置(x1,x2,x3),当且仅当它各部分的 nim-sum 等于 0 时（即 x1⊕x2⊕x3=0），则当前位于必败点。

## Graph Games & Sprague-Grundy Function

![nim-game的状态转移图](https://i.loli.net/2020/05/09/UyF3NG7zijS2Y6h.png)

## SG 函数

![sg](https://i.loli.net/2020/05/09/qXY8D3KmsgQhrvj.png)

也就是说，X 节点的 SG 值是去除 X 的后继节点的 SG 值后的最小的非负整数

![sg应用](https://i.loli.net/2020/05/09/apCqPOMEgTiKu87.png)

### SG 示例

若 S={1,2,3} (S 代表，每次能取数的集合)，请计算简单取子游戏的 SG 值

![SG计算](https://i.loli.net/2020/05/09/atqdZPb6wJilup9.png)

# 组合游戏的并

有时，一个游戏可以有多个小的游戏组成，这时`SG函数`仍然适用。

![SG计算](https://i.loli.net/2020/05/09/KzU1O8WxQECJMb6.png)

## SG 函数的实现

```cpp
int k,a[100],f[10001];

//这里使用递归，还可以优化
int sg(int p){//p是所求节点
    int i,t;
    bool g[101]={0};
    for(i=0;i<k;i++){
        t=p-a[i]; //这里要求a已经是升序
        if(t<0)
            break;
        if(f[t]==-1)  //f需要初始化为-1
            f[t]=sg(t);
        g[f[t]]=1;
    }
    for(i=0;;i++){//从0开始寻找最小的满足值即为SG函数值
        if(!g[i])
            return i;
    }
}
```

## TODO 优化 SG 函数
